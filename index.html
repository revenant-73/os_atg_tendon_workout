<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ATG Tendon Daily</title>
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.css">
    <style>
        :root {
            --bg: #000000;
            --card-bg: #111111;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.1);
            --text: #ffffff;
            --text-muted: #888888;
            --border: #222222;
            --success: #22c55e;
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
            padding-bottom: 120px;
        }

        header {
            padding: 40px 20px 20px;
            background: linear-gradient(to bottom, #111, #000);
            border-bottom: 1px solid var(--border);
        }

        h1 { margin: 0; font-size: 1.5rem; font-weight: 800; letter-spacing: -0.02em; }
        .sub-header { color: var(--text-muted); font-size: 0.9rem; margin-top: 4px; }

        .container { max-width: 500px; margin: 0 auto; padding: 20px; }

        .selector-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .week-info h2 { margin: 0; font-size: 1.1rem; }
        .week-info p { margin: 0; font-size: 0.8rem; color: var(--accent); font-weight: 600; text-transform: uppercase; }

        select {
            background: #222;
            color: white;
            border: 1px solid var(--border);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin: 32px 0 12px 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exercise-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: border-color 0.2s;
        }

        .exercise-card.completed {
            border-color: var(--success);
            opacity: 0.7;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            cursor: pointer;
        }

        .completed .checkbox {
            background: var(--success);
            border-color: var(--success);
        }

        .checkbox::after {
            content: "✓";
            color: white;
            font-weight: bold;
            display: none;
        }

        .completed .checkbox::after { display: block; }

        .exercise-info { flex-grow: 1; }
        .exercise-name { font-weight: 600; font-size: 1rem; }
        .exercise-target { font-size: 0.85rem; color: var(--accent); font-weight: 500; }
        .exercise-note { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }

        .optional-badge {
            font-size: 0.65rem;
            background: #222;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            vertical-align: middle;
        }

        /* Floating Timer Bar */
        .timer-bar {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .timer-display { font-variant-numeric: tabular-nums; font-size: 1.5rem; font-weight: 700; }
        .timer-controls { display: flex; gap: 8px; }

        button {
            border: none;
            border-radius: 12px;
            padding: 10px 20px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button:active { transform: scale(0.95); }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #222; color: white; }

        .progress-indicator {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .timing { animation: pulse 1s infinite; color: var(--accent); }
    </style>
</head>
<body>

<header>
    <h1>Daily Tendon Practice</h1>
    <div class="sub-header">Prepared, Not Tired • 8–10 Weeks</div>
</header>

<div class="container">
    <div class="selector-card">
        <div class="week-info">
            <p id="blockLabel">Block 1</p>
            <h2 id="blockName">Restore & Map</h2>
            <div class="progress-indicator"><div id="progressBar" class="progress-fill"></div></div>
        </div>
        <select id="weekSelect">
            <!-- JS will populate -->
        </select>
    </div>

    <div id="workoutContent">
        <!-- JS will populate -->
    </div>
</div>

<div class="timer-bar">
    <div>
        <div style="font-size: 0.6rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: -2px;">Hold Timer</div>
        <div id="timerText" class="timer-display">00:30</div>
    </div>
    <div class="timer-controls">
        <button id="timerPresetBtn" class="btn-secondary">30s</button>
        <button id="timerStartBtn" class="btn-primary">START</button>
    </div>
</div>

<script>
    const workoutData = {
        sections: [
            {
                id: 'reset',
                title: '1. RESET (5–7m)',
                exercises: [
                    { id: 'breathing_sup', name: 'Supine breathing', target: '5–8 slow breaths' },
                    { id: 'breathing_croc', name: 'Crocodile breathing', target: '5–8 slow breaths' },
                    { id: 'neck_nods', name: 'Neck nods (yes/no)', target: '10–15 reps' },
                    { id: 'rocking', name: 'Rocking (quadruped/seated)', target: '15–20 reps' },
                    { id: 'rolling', name: 'Rolling (supine ↔ prone)', target: '4–6 total' },
                    { id: 'crawl_easy', name: 'Easy crawl', target: '30–60s', optional: true }
                ]
            },
            {
                id: 'tendon',
                title: '2. TENDON ISOMETRICS (6–8m)',
                exercises: [
                    { id: 'calf_iso', name: 'Bent-knee calf isometric', target: 'ISO Hold' },
                    { id: 'tib_raises', name: 'Tibialis raises', target: 'Reps or ISO' },
                    { id: 'split_iso', name: 'Split squat isometric hold', target: 'ISO Hold' }
                ]
            },
            {
                id: 'atg',
                title: '3. ATG STRENGTH (8–12m)',
                exercises: [
                    { id: 'atg_ss', name: 'ATG split squat', target: 'Controlled reps + pauses' },
                    { id: 'hf_breath', name: 'Hip flexor breathing', target: '5–8 breaths/side' },
                    { id: 'wall_sit', name: 'Wall sit', target: 'Optional Choice', optional: true },
                    { id: 'squat_breath', name: 'Deep squat breathing', target: 'Optional Choice', optional: true },
                    { id: 'hinge', name: 'Light hinge pattern', target: 'Optional Choice', optional: true }
                ]
            },
            {
                id: 'biglift',
                title: '4. BIG LIFT SLOT (Optional, 5–10m)',
                exercises: [
                    { id: 'sled_push', name: 'Sled push', target: 'Primary' },
                    { id: 'sled_pull', name: 'Sled pull', target: 'Alternative' },
                    { id: 'kb_swing', name: 'Heavy kettlebell swings', target: 'Later blocks', optional: true },
                    { id: 'j_curl', name: 'Jefferson curls', target: 'Later blocks', optional: true }
                ]
            },
            {
                id: 'integration',
                title: '5. INTEGRATION (3–6m)',
                exercises: [
                    { id: 'f_crawl', name: 'Forward crawl', target: 'Choose 1-2' },
                    { id: 'b_crawl', name: 'Backward crawl', target: 'Choose 1-2' },
                    { id: 'l_crawl', name: 'Lateral crawl', target: 'Choose 1-2' },
                    { id: 'bear_hold', name: 'Bear hold', target: 'Choose 1-2' },
                    { id: 'marching', name: 'Marching (slow)', target: 'Choose 1-2' },
                    { id: 'transitions', name: 'Floor transitions', target: 'Choose 1-2' }
                ]
            },
            {
                id: 'exploration',
                title: '6. OPTIONAL EXPLORATION (10–15m)',
                exercises: [
                    { id: 'long_crawl', name: 'Longer crawling session', target: 'Skip anytime', optional: true },
                    { id: 'ground_flow', name: 'Ground flow', target: 'Skip anytime', optional: true },
                    { id: 'carries', name: 'Carries', target: 'Skip anytime', optional: true },
                    { id: 'light_sled', name: 'Very light sled work', target: 'Skip anytime', optional: true },
                    { id: 'get_ups', name: 'Get-up patterns', target: 'Skip anytime', optional: true },
                    { id: 'mobility', name: 'Mobility exploration', target: 'Skip anytime', optional: true }
                ]
            }
        ]
    };

    const state = {
        week: parseInt(localStorage.getItem('atg_week')) || 1,
        completed: JSON.parse(localStorage.getItem('atg_completed')) || {},
        today: new Date().toDateString()
    };

    function getBlock(week) {
        if (week <= 2) return { id: 1, name: 'Restore & Map', iso: 30, big: 'OFF' };
        if (week <= 4) return { id: 2, name: 'Own the Range', iso: 45, big: 'Sled Only' };
        if (week <= 6) return { id: 3, name: 'Capacity Without Chaos', iso: 60, big: 'Sled + KB' };
        return { id: 4, name: 'Integration & Expression', iso: 45, big: 'Any' };
    }

    function save() {
        localStorage.setItem('atg_week', state.week);
        localStorage.setItem('atg_completed', JSON.stringify(state.completed));
    }

    function toggleExercise(id) {
        const key = `${state.today}_${id}`;
        state.completed[key] = !state.completed[key];
        save();
        render();
    }

    function render() {
        const block = getBlock(state.week);
        document.getElementById('blockLabel').textContent = `Block ${block.id}`;
        document.getElementById('blockName').textContent = block.name;
        
        const workoutContent = document.getElementById('workoutContent');
        workoutContent.innerHTML = '';

        let totalDone = 0;
        let totalExercises = 0;

        workoutData.sections.forEach(section => {
            const sectionEl = document.createElement('div');
            let ruleHtml = '';
            if (section.id === 'biglift') {
                ruleHtml = `<div class="exercise-note" style="margin-bottom: 8px; color: var(--accent);">Block Rule: ${block.big}</div>`;
            }
            sectionEl.innerHTML = `<div class="section-title">${section.title}</div>${ruleHtml}`;
            
            section.exercises.forEach(ex => {
                const isCompleted = state.completed[`${state.today}_${ex.id}`];
                if (!ex.optional) {
                    totalExercises++;
                    if (isCompleted) totalDone++;
                }

                // Dynamic target for Tendon section
                let target = ex.target;
                if (section.id === 'tendon' && ex.id !== 'tib_raises') {
                    target = `${block.iso}s Hold`;
                }

                const card = document.createElement('div');
                card.className = `exercise-card ${isCompleted ? 'completed' : ''}`;
                card.onclick = () => toggleExercise(ex.id);
                card.innerHTML = `
                    <div class="checkbox"></div>
                    <div class="exercise-info">
                        <div class="exercise-name">
                            ${ex.name} ${ex.optional ? '<span class="optional-badge">OPTIONAL</span>' : ''}
                        </div>
                        <div class="exercise-target">${target}</div>
                    </div>
                `;
                sectionEl.appendChild(card);
            });
            workoutContent.appendChild(sectionEl);
        });

        const progress = (totalDone / totalExercises) * 100;
        document.getElementById('progressBar').style.width = `${progress}%`;
    }

    // Timer Logic
    let timerInterval;
    let timerTime = 30;
    const timerText = document.getElementById('timerText');
    const timerStartBtn = document.getElementById('timerStartBtn');
    const timerPresetBtn = document.getElementById('timerPresetBtn');

    function updateTimerDisplay() {
        const m = Math.floor(timerTime / 60).toString().padStart(2, '0');
        const s = (timerTime % 60).toString().padStart(2, '0');
        timerText.textContent = `${m}:${s}`;
    }

    timerStartBtn.onclick = () => {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
            timerStartBtn.textContent = 'START';
            timerText.classList.remove('timing');
        } else {
            timerText.classList.add('timing');
            timerStartBtn.textContent = 'STOP';
            timerInterval = setInterval(() => {
                timerTime--;
                updateTimerDisplay();
                if (timerTime <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    timerStartBtn.textContent = 'START';
                    timerText.classList.remove('timing');
                    navigator.vibrate && navigator.vibrate([200, 100, 200]);
                }
            }, 1000);
        }
    };

    timerPresetBtn.onclick = () => {
        const presets = [30, 45, 60, 90];
        let idx = presets.indexOf(timerTime);
        timerTime = presets[(idx + 1) % presets.length];
        timerPresetBtn.textContent = `${timerTime}s`;
        updateTimerDisplay();
    };

    // Initialize
    const weekSelect = document.getElementById('weekSelect');
    for (let i = 1; i <= 10; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `Week ${i}`;
        if (i === state.week) opt.selected = true;
        weekSelect.appendChild(opt);
    }

    weekSelect.onchange = (e) => {
        state.week = parseInt(e.target.value);
        save();
        render();
        // Update timer preset based on block
        timerTime = getBlock(state.week).iso;
        timerPresetBtn.textContent = `${timerTime}s`;
        updateTimerDisplay();
    };

    // Initial render
    render();
    timerTime = getBlock(state.week).iso;
    timerPresetBtn.textContent = `${timerTime}s`;
    updateTimerDisplay();

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
    }
</script>

</body>
</html>
